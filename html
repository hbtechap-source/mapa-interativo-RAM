 patrulha_equipe.html
  Aplica√ß√£o para equipes (1¬∫, 2¬∫, 4¬∫ e 6¬∫ BPM)
  Cont√©m tela de login (usu√°rio/senha) ‚Äî autentica√ß√£o DESATIVADA por enquanto:
  ao clicar em "Entrar" o app abre sem valida√ß√£o (apenas proceed).
  Formul√°rio com op√ß√£o de Ficha / Relat√≥rio, captura de geolocaliza√ß√£o e envio via fetch()
  Substitua SCRIPT_URL pelo endpoint do seu Apps Script (Web App).
-->

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Equipe ‚Äî Patrulha Maria da Penha</title>
  <style>
    :root{
      --primary:#2b6cb0;
      --muted:#666;
      --bg:#f4f6f9;
      --card:#ffffff;
      font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#222}
    .center{max-width:1100px;margin:1.5rem auto;padding:1rem}
    .card{background:var(--card);border-radius:10px;padding:1rem;box-shadow:0 6px 20px rgba(15,23,42,0.06)}
    header{background:var(--primary);color:#fff;padding:1rem;border-radius:10px 10px 0 0;text-align:center}
    h1{margin:0;font-size:1.15rem}
    .split{display:grid;grid-template-columns:1fr 420px;gap:1rem}
    @media(max-width:940px){ .split{grid-template-columns:1fr} }

    /* login */
    .login-box{max-width:420px;margin:2rem auto;padding:1.2rem;border-radius:10px}
    label{display:block;margin-top:0.65rem;font-weight:600;color:var(--muted)}
    input[type="text"], input[type="password"], input[type="date"], select, textarea{
      width:100%;padding:0.6rem;border:1px solid #e2e8f0;border-radius:8px;margin-top:0.35rem;
    }
    textarea{min-height:110px;resize:vertical}
    button.btn{margin-top:1rem;padding:0.7rem 1rem;border:0;border-radius:8px;background:var(--primary);color:#fff;font-weight:700;cursor:pointer}
    .muted{color:var(--muted);font-size:0.9rem;margin-top:0.5rem}
    .row{display:flex;gap:0.6rem}
    .col{flex:1}
    .small{font-size:0.85rem;color:var(--muted)}
    .status{margin-top:0.7rem;font-weight:600}

    /* form styles */
    .tabs{display:flex;gap:0.5rem;margin-bottom:0.8rem}
    .tab{padding:0.45rem 0.8rem;border-radius:8px;background:#eef2f7;cursor:pointer;font-weight:700;color:#123}
    .tab.active{background:var(--primary);color:#fff}
    .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:0.75rem}
    .gps-row{display:flex;gap:0.5rem;align-items:center}
    .gps-row input{flex:1}
    footer{margin-top:1rem;font-size:0.85rem;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <div class="center">

    <!-- LOGIN (AUTENTICA√á√ÉO DESATIVADA) -->
    <div class="card login-box" id="loginCard">
      <header><h1>Equipe ‚Äî Patrulha Maria da Penha</h1></header>

      <div style="padding:0.8rem">
        <label>Usu√°rio</label>
        <input type="text" id="loginUser" placeholder="Seu usu√°rio (ex: sgt.joseanne)">

        <label>Senha</label>
        <input type="password" id="loginPass" placeholder="Senha (desativada por enquanto)">

        <p class="small">Observa√ß√£o: para este prot√≥tipo a autentica√ß√£o est√° desativada ‚Äî basta clicar em "Entrar" para acessar o formul√°rio.</p>

        <button class="btn" id="btnLogin">Entrar</button>
        <p class="status" id="loginStatus" style="color:green;display:none">Acessando...</p>
      </div>
    </div>

    <!-- APLICA√á√ÉO (inicialmente oculta, aparece ap√≥s 'Entrar') -->
    <div id="app" style="display:none">
      <div class="card">
        <header><h1>Formul√°rio de Envio ‚Äî Patrulha (Equipe)</h1></header>

        <div style="padding:1rem">
          <div class="tabs" role="tablist" aria-label="Tipo de documento">
            <div class="tab active" data-type="Ficha" id="tabFicha">Ficha de Fiscaliza√ß√£o</div>
            <div class="tab" data-type="Relatorio" id="tabRelatorio">Relat√≥rio de Equipe</div>
          </div>

          <form id="teamForm">
            <input type="hidden" name="docType" id="docType" value="Ficha de Fiscaliza√ß√£o">

            <div class="form-grid">
              <!-- Dados da v√≠tima / relat√≥rio -->
              <div>
                <label>Nome da V√≠tima <span class="small">(obrigat√≥rio na Ficha)</span></label>
                <input type="text" name="victimName" id="victimName" placeholder="Nome completo">
              </div>

              <div>
                <label>MPU / Processo n¬∫</label>
                <input type="text" name="mpuNumber" id="mpuNumber" placeholder="6017773-21.2025.8.03.0001">
              </div>

              <div>
                <label>Endere√ßo / Bairro</label>
                <input type="text" name="victimAddress" id="victimAddress" placeholder="Rua, n¬∫, bairro">
              </div>

              <div>
                <label>Contato (telefone/whatsapp)</label>
                <input type="text" name="victimContact" id="victimContact" placeholder="(96) 9XXXX-XXXX">
              </div>

              <div>
                <label>Nome do Agressor</label>
                <input type="text" name="aggressorName" id="aggressorName" placeholder="Nome completo">
              </div>

              <div>
                <label>Tipo de Viol√™ncia</label>
                <select name="violenceType" id="violenceType">
                  <option value="">‚Äî Selecionar ‚Äî</option>
                  <option>F√≠sica</option>
                  <option>Psicol√≥gica</option>
                  <option>Patrimonial</option>
                  <option>Sexual</option>
                </select>
              </div>

              <div>
                <label>Batalh√£o (quem realiza)</label>
                <select name="bpm" id="bpm">
                  <option value="">‚Äî Selecionar ‚Äî</option>
                  <option>1¬∫ BPM</option>
                  <option>2¬∫ BPM</option>
                  <option>4¬∫ BPM</option>
                  <option>6¬∫ BPM</option>
                </select>
              </div>

              <div>
                <label>Equipe / Comandante</label>
                <input type="text" name="teamCommander" id="teamCommander" placeholder="Ex: 1¬∫ Sgt Joseanne">
              </div>

              <div>
                <label>Data da Visita</label>
                <input type="date" name="visitDate" id="visitDate">
              </div>

              <div>
                <label>Hor√°rio</label>
                <input type="text" name="visitTime" id="visitTime" placeholder="HH:MM (opcional)">
              </div>
            </div>

            <label style="margin-top:0.9rem">Resumo do Caso / Relato da Visita <span class="small">(obrigat√≥rio na Ficha)</span></label>
            <textarea name="reportText" id="reportText" placeholder="Descreva: orienta√ß√£o, testemunhas, medidas tomadas, comportamento do agressor..."></textarea>

            <label style="margin-top:0.8rem">Apensos / Processos relacionados</label>
            <input type="text" name="relatedProcesses" id="relatedProcesses" placeholder="N¬∫s de processo MPU, medidas protetivas">

            <div style="margin-top:0.6rem" class="gps-row">
              <div style="flex:1">
                <label>Localiza√ß√£o (Latitude)</label>
                <input type="text" name="latitude" id="latitude" readonly placeholder="Latitude">
              </div>
              <div style="flex:1">
                <label>Localiza√ß√£o (Longitude)</label>
                <input type="text" name="longitude" id="longitude" readonly placeholder="Longitude">
              </div>
              <div style="width:156px">
                <label style="visibility:hidden">bot</label>
                <button type="button" class="btn" id="btnGeo" style="width:100%">üìç Capturar</button>
              </div>
            </div>

            <label style="margin-top:0.6rem">Observa√ß√µes / Encaminhamentos</label>
            <input type="text" name="observations" id="observations" placeholder="Encaminhamentos √† coordena√ß√£o / escola / sa√∫de etc">

            <label style="margin-top:0.6rem">Assinatura (Nome e Posto)</label>
            <input type="text" name="signature" id="signature" placeholder="Nome ‚Äî Posto">

            <div style="display:flex;gap:0.6rem;margin-top:0.8rem">
              <button type="button" class="btn" id="btnSubmit">Enviar relat√≥rio</button>
              <button type="button" class="btn" id="btnReset" style="background:#e2e8f0;color:#111">Limpar</button>
            </div>

            <p class="muted" style="margin-top:0.6rem">
              Observa√ß√£o: uploads de arquivos (fotos/documentos) n√£o est√£o habilitados por este prot√≥tipo.
              Caso necess√°rio, inclua links do Google Drive no campo Observa√ß√µes ou solicite ativa√ß√£o do upload no Apps Script.
            </p>

            <p id="formStatus" class="status" style="display:none"></p>
          </form>
        </div>
      </div>

      <footer>
        <small>Uso restrito √†s equipes: 1¬∫ BPM, 2¬∫ BPM, 4¬∫ BPM e 6¬∫ BPM ‚Äî Sistema de prot√≥tipo</small>
      </footer>
    </div>
  </div>

<script>
/* ==========================
   CONFIGURA√á√ÉO: substitua pelo endpoint do seu Apps Script (deploy Web App)
   ========================== */
const SCRIPT_URL = 'https://script.google.com/macros/s/SEU_DEPLOY_ID_AQUI/exec';

/* --------- Login (autentica√ß√£o desativada) --------- */
document.getElementById('btnLogin').addEventListener('click', () => {
  // A autentica√ß√£o est√° desativada ‚Äî apenas abre o app ao clicar
  document.getElementById('loginStatus').style.display = 'inline';
  setTimeout(() => {
    document.getElementById('loginCard').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    document.getElementById('loginStatus').style.display = 'none';
    // preencher data/hora atual por conveni√™ncia
    const today = new Date();
    document.getElementById('visitDate').value = today.toISOString().slice(0,10);
    document.getElementById('visitTime').value = today.toTimeString().slice(0,5);
  }, 600); // pequena anima√ß√£o
});

/* --------- Tabs (Ficha / Relat√≥rio) --------- */
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    const type = tab.dataset.type;
    document.getElementById('docType').value = (type === 'Ficha') ? 'Ficha de Fiscaliza√ß√£o' : 'Relat√≥rio de Equipe';
    // ajustar obrigatoriedade: quando for Relat√≥rio, o campo v√≠tima pode ser opcional
    const victim = document.getElementById('victimName');
    const report = document.getElementById('reportText');
    if(type === 'Ficha'){
      victim.required = true;
      report.required = true;
    } else {
      victim.required = false;
      report.required = true;
    }
  });
});

/* --------- Geolocaliza√ß√£o --------- */
document.getElementById('btnGeo').addEventListener('click', () => {
  const latInput = document.getElementById('latitude');
  const lonInput = document.getElementById('longitude');

  if(!navigator.geolocation){
    alert('Geolocaliza√ß√£o n√£o suportada neste dispositivo');
    return;
  }
  document.getElementById('btnGeo').textContent = 'Buscando...';
  navigator.geolocation.getCurrentPosition(pos => {
    latInput.value = pos.coords.latitude.toFixed(6);
    lonInput.value = pos.coords.longitude.toFixed(6);
    document.getElementById('btnGeo').textContent = 'üìç Capturar';
  }, err => {
    alert('Erro ao capturar localiza√ß√£o: ' + err.message);
    document.getElementById('btnGeo').textContent = 'üìç Capturar';
  }, {enableHighAccuracy:true, timeout:10000});
});

/* --------- Envio do formul√°rio (POST JSON para Apps Script) --------- */
document.getElementById('btnSubmit').addEventListener('click', async () => {
  const status = document.getElementById('formStatus');
  status.style.display = 'block';
  status.style.color = 'black';
  status.textContent = 'Validando...';

  const form = document.getElementById('teamForm');
  // simples valida√ß√£o: campos obrigat√≥rios conforme tipo
  const docType = document.getElementById('docType').value;
  const victimName = document.getElementById('victimName').value.trim();
  const reportText = document.getElementById('reportText').value.trim();
  if(docType.includes('Ficha') && victimName === ''){
    status.style.color = 'crimson';
    status.textContent = 'Erro: Nome da v√≠tima √© obrigat√≥rio para Ficha.';
    return;
  }
  if(reportText === ''){
    status.style.color = 'crimson';
    status.textContent = 'Erro: Relato/Resumo do caso √© obrigat√≥rio.';
    return;
  }

  // montar payload
  const payload = {};
  new FormData(form).forEach((v,k) => payload[k] = v);
  payload.submittedAt = new Date().toISOString();
  // adicionar meta da equipe (opcional)
  payload.device = navigator.userAgent || '';

  status.style.color = 'black';
  status.textContent = 'Enviando...';

  try {
    // Envia para Apps Script (Content-Type application/json)
    const resp = await fetch(SCRIPT_URL, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });

    const resJson = await resp.json();
    if(resp.ok && resJson.result === 'success'){
      status.style.color = 'green';
      status.textContent = 'Relat√≥rio enviado com sucesso.';
      form.reset();
      // reset docType to current tab (default Ficha)
      document.getElementById('docType').value = document.querySelector('.tab.active').dataset.type === 'Ficha' ? 'Ficha de Fiscaliza√ß√£o' : 'Relat√≥rio de Equipe';
      // opcional: recapturar data/hora
      const t = new Date();
      document.getElementById('visitDate').value = t.toISOString().slice(0,10);
      document.getElementById('visitTime').value = t.toTimeString().slice(0,5);
    } else {
      // se Apps Script responder com erro
      status.style.color = 'crimson';
      status.textContent = 'Falha ao enviar: ' + (resJson.message || 'resposta inesperada do servidor');
    }
  } catch (err) {
    status.style.color = 'crimson';
    status.textContent = 'Erro de rede: ' + err.message;
  }
});

/* --------- Reset do formul√°rio --------- */
document.getElementById('btnReset').addEventListener('click', () => {
  if(confirm('Limpar todos os campos do formul√°rio?')){
    document.getElementById('teamForm').reset();
    document.getElementById('latitude').value = '';
    document.getElementById('longitude').value = '';
    document.getElementById('formStatus').style.display = 'none';
  }
});
</script>
</body>
</html>
